<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç•ªèŒ„é’Ÿ++ - å¤šæ¨¡å¼ç‰ˆ</title>
    <style>
        /* ç”¨æˆ·æä¾›çš„CSSå†…å®¹ */
        body {
            font-family: sans-serif;
            background-color: #f0f8ff;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        .container {
            text-align: center;
        }
        #timer {
            font-size: 5em;
            margin: 20px;
            color: #e74c3c;
        }
        button {
            padding: 10px 20px;
            font-size: 1em;
            margin: 5px;
            cursor: pointer;
        }

        /* åŸHTMLçš„å¤æ‚æ ·å¼ */
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            transition: background 0.5s ease;
        }

        body.working {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
        }

        body.breaking {
            background: linear-gradient(135deg, #1dd1a1 0%, #10ac84 100%);
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px 30px 30px 30px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            text-align: center;
            width: 100%;
            max-width: 900px;
            backdrop-filter: blur(10px);
            position: relative;
            max-height: 85vh;
            overflow-y: auto;
            
            /* å½»åº•éšè—æ»šåŠ¨æ¡ */
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        /* éšè—æ‰€æœ‰æ»šåŠ¨æ¡ä½†ä¿ç•™æ»šåŠ¨åŠŸèƒ½ */
        .container::-webkit-scrollbar,
        .collection-grid::-webkit-scrollbar,
        .history-list::-webkit-scrollbar,
        .plan-list::-webkit-scrollbar {
            width: 0px;
            background: transparent;
        }

        /* é’ˆå¯¹Firefoxç­‰æµè§ˆå™¨ */
        .container {
            scrollbar-width: none;
        }

        .collection-grid,
        .history-list,
        .plan-list {
            scrollbar-width: none;
        }

        /* èœå•æ æ ·å¼ */
        .menu-bar {
            position: absolute;
            top: 20px;
            left: 15px;
            display: flex;
            gap: 10px;
            z-index: 100;
        }

        .menu-btn {
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            display: none; /* éšè—åŸæœ‰æŒ‰é’® */
        }

        .menu-btn:hover {
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .menu-btn.active {
            background: #3498db;
            color: white;
        }

        /* èœå•å›¾æ ‡æŒ‰é’®æ ·å¼ */
        .menu-icon-btn {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            padding: 8px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            font-size: 1.2em;
        }

        .menu-icon-btn:hover {
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        /* ä¸‹æ‹‰èœå•æ ·å¼ */
        .dropdown-menu {
            position: absolute;
            top: 50px;
            left: 0;
            background: white;
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            min-width: 180px;
            z-index: 1000;
            opacity: 0;
            transform: translateY(-20px);
            visibility: hidden;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .dropdown-menu.show {
            opacity: 1;
            transform: translateY(0);
            visibility: visible;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            cursor: pointer;
            transition: background 0.2s ease;
            border-bottom: 1px solid #f0f0f0;
        }

        .menu-item:last-child {
            border-bottom: none;
        }

        .menu-item:hover {
            background: #f8f9fa;
        }

        .menu-item.active {
            background: #e3f2fd;
        }

        .menu-item span {
            font-size: 0.95em;
            color: #2d3436;
            font-weight: 500;
        }

        h1 {
            color: #2d3436;
            margin-bottom: 10px;
            font-size: 2em;
        }

        #task {
            width: 80%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1em;
            margin-bottom: 20px;
            text-align: center;
            transition: border-color 0.3s;
        }

        #task:focus {
            outline: none;
            border-color: #667eea;
        }

        #timer {
            font-size: 5em;
            font-weight: bold;
            margin: 30px 0;
            color: #2d3436;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .buttons {
            margin: 25px 0;
        }

        button {
            padding: 12px 30px;
            font-size: 1.1em;
            margin: 0 10px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        #startPauseBtn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        #startPauseBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        #resetBtn {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
        }

        #resetBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(245, 87, 108, 0.4);
        }

        #countDisplay {
            font-size: 1.2em;
            color: #636e72;
            margin-top: 20px;
        }

        #count {
            font-weight: bold;
            color: #e84393;
            font-size: 1.4em;
        }

        .status {
            font-size: 1.2em;
            font-weight: bold;
            margin-top: 10px;
            padding: 8px 15px;
            border-radius: 20px;
            display: inline-block;
        }

        .status.work {
            background: #ffeaa7;
            color: #e17055;
        }

        .status.break {
            background: #81ecec;
            color: #00b894;
        }

        .shortcut-hint {
            font-size: 0.9em;
            color: #636e72;
            margin-top: 15px;
        }

        /* è®¾ç½®æŒ‰é’®æ ·å¼ - å¾€å³ç§»åŠ¨ */
        #settingsBtn {
            position: absolute;
            top: 20px;
            right: 40px;
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #636e72;
            padding: 5px;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #settingsBtn:hover {
            background: rgba(0, 0, 0, 0.1);
            color: #2d3436;
        }

        /* è®¾ç½®é¢æ¿æ ·å¼ */
        .settings-panel {
            display: none;
            position: absolute;
            top: 60px;
            right: 20px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 100;
            min-width: 280px;
        }

        .settings-panel h3 {
            margin-top: 0;
            color: #2d3436;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }

        .mode-selector {
            margin-bottom: 20px;
        }

        .mode-tabs {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .mode-tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
        }

        .mode-tab.active {
            border-bottom: 2px solid #3498db;
            color: #3498db;
            font-weight: bold;
        }

        .mode-content {
            display: none;
        }

        .mode-content.active {
            display: block;
        }

        .setting-group {
            margin-bottom: 15px;
        }

        .setting-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #636e72;
        }

        .setting-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
        }

        .setting-hint {
            font-size: 0.8em;
            color: #95a5a6;
            margin-top: 5px;
        }

        .setting-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }

        .setting-buttons button {
            padding: 8px 15px;
            margin: 0;
        }

        #saveSettings {
            background: #00b894;
            color: white;
        }

        #cancelSettings {
            background: #dfe6e9;
            color: #2d3436;
        }

        /* é®ç½©å±‚ */
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 50;
        }

        /* å¤šæ¤ç‰©ç³»ç»Ÿæ ·å¼ */
        .plant-system {
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            background: #f8f9fa;
        }

        .plant-selector {
            margin-bottom: 20px;
            text-align: center;
        }

        .plant-selector select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: white;
            font-size: 1em;
            margin-right: 10px;
        }

        .plant-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .plant-icon {
            font-size: 3em;
            display: block;
        }

        .plant-details {
            text-align: left;
        }

        .plant-name {
            font-weight: bold;
            font-size: 1.2em;
            color: #2d3436;
        }

        .plant-time {
            color: #636e72;
            font-size: 0.9em;
        }

        .plant-container {
            position: relative;
            width: 200px;
            height: 200px;
            margin: 10px auto;
            display: flex;
            justify-content: center;
            align-items: flex-end;
        }

        .soil {
            width: 120px;
            height: 25px;
            background: #8B4513;
            border-radius: 50%;
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1;
        }

        .plant-stage {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            transition: all 0.5s ease;
            opacity: 0;
            z-index: 2;
            display: flex;
            align-items: flex-end;
            justify-content: center;
        }

        /* ç§å­é˜¶æ®µ - æœ€å° */
        #stage-seed {
            max-width: 40px;
            max-height: 40px;
            bottom: 15px;
        }

        /* å‘èŠ½é˜¶æ®µ - ç¨å¤§ */
        #stage-sprout {
            max-width: 60px;
            max-height: 60px;
            bottom: 12px;
        }

        /* å°è‹—é˜¶æ®µ - ä¸­ç­‰ */
        #stage-small {
            max-width: 80px;
            max-height: 80px;
            bottom: 10px;
        }

        /* ä¸­è‹—é˜¶æ®µ - è¾ƒå¤§ */
        #stage-medium {
            max-width: 100px;
            max-height: 100px;
            bottom: 8px;
        }

        /* æˆç†Ÿé˜¶æ®µ - æœ€å¤§ */
        #stage-mature {
            max-width: 120px;
            max-height: 120px;
            bottom: 5px;
        }

        .plant-stage.active {
            opacity: 1;
        }

        .plant-stage img {
            width: 100%;
            height: auto;
            display: block;
            transition: all 0.5s ease;
        }

        .growth-info {
            margin-top: 10px;
            text-align: center;
        }

        .growth-bar {
            width: 100%;
            height: 10px;
            background: #ecf0f1;
            border-radius: 5px;
            margin: 10px 0;
            overflow: hidden;
        }

        .growth-progress {
            height: 100%;
            border-radius: 5px;
            transition: width 0.5s ease;
        }

        .collection-section {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            background: #f8f9fa;
        }

        .collection-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #2d3436;
        }

        .collection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
            gap: 10px;
        }

        .collection-item {
            width: 70px;
            height: 70px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8em;
            position: relative;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .collection-icon {
            font-size: 1.5em;
            margin-bottom: 5px;
        }

        .new-plant-btn {
            background: #3498db;
            color: white;
            margin-top: 10px;
        }

        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #2ecc71;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .notification.show {
            opacity: 1;
        }

        /* å†å²è®°å½•æ ·å¼ */
        .history-section {
            margin: 40px 0 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid #e9ecef;
            display: none;
        }

        .history-list {
            margin-top: 15px;
        }

        .history-item {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-task {
            font-weight: bold;
            color: #2d3436;
        }

        .history-time {
            color: #636e72;
            font-size: 0.9em;
        }

        .history-date {
            font-size: 0.8em;
            color: #95a5a6;
        }

        .empty-history {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
            font-style: italic;
        }

        .clear-history {
            background: #e74c3c;
            color: white;
            margin-top: 15px;
        }

        /* æ‰˜ç›˜å›¾æ ‡æ ·å¼ */
        .tray-notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #3498db;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .tray-notification.show {
            opacity: 1;
        }

        /* è¿›åº¦æŒ‡ç¤ºå™¨ */
        .progress-indicator {
            margin: 10px 0;
            font-size: 1.1em;
            color: #636e72;
        }
        
        /* æ”¶è·ç»Ÿè®¡ */
        .harvest-stats {
            margin-top: 10px;
            font-size: 0.9em;
            color: #7f8c8d;
        }
        
        /* å“è´¨æ ·å¼ */
        .quality-super {
            color: #FFD700 !important;
            font-weight: bold;
            text-shadow: 0 0 3px rgba(255, 215, 0, 0.5);
        }
        
        .quality-rare {
            color: #C0C0C0 !important;
            font-weight: bold;
        }
        
        .quality-normal {
            color: white !important;
        }

        /* è®¡åˆ’é¡µé¢æ ·å¼ */
        .plan-section {
            margin: 40px 0 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid #e9ecef;
            display: none;
        }

        .plan-input {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        #planInput {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
        }

        #planInput:focus {
            outline: none;
            border-color: #667eea;
        }

        #addPlanBtn {
            padding: 12px 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        #addPlanBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .plan-list {
            margin-top: 15px;
        }

        .plan-item {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .plan-content {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }

        .plan-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .plan-text {
            flex: 1;
            color: #2d3436;
            font-size: 1em;
        }

        .plan-text.completed {
            text-decoration: line-through;
            color: #95a5a6;
        }

        .plan-actions {
            display: flex;
            gap: 8px;
        }

        .plan-delete {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 6px 12px;
            cursor: pointer;
            font-size: 0.8em;
            transition: background 0.3s ease;
        }

        .plan-delete:hover {
            background: #c0392b;
        }

        .empty-plan {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
            font-style: italic;
        }
    </style>
</head>
<body class="working">
    <div class="container">
        <!-- èœå•æ  -->
        <div class="menu-bar">
            <!-- åŸæœ‰çš„æŒ‰é’®ä¿ç•™ä½†éšè— -->
            <button class="menu-btn active" id="homeBtn" style="display: none;">ç•ªèŒ„é’Ÿä¸»é¡µ</button>
            <button class="menu-btn" id="historyBtn" style="display: none;">å†å²è®°å½•</button>
            <button class="menu-btn" id="planBtn" style="display: none;">è®¡åˆ’</button>
            
            <!-- æ–°çš„èœå•æŒ‰é’® -->
            <button class="menu-icon-btn" id="menuToggleBtn">
                â˜°
            </button>
            
            <!-- ä¸‹æ‹‰èœå• -->
            <div class="dropdown-menu" id="dropdownMenu">
                <div class="menu-item" data-page="home">
                    ğŸ 
                    <span>ç•ªèŒ„é’Ÿä¸»é¡µ</span>
                </div>
                <div class="menu-item" data-page="plan">
                    ğŸ“
                    <span>è®¡åˆ’</span>
                </div>
                <div class="menu-item" data-page="history">
                    ğŸ“š
                    <span>å†å²è®°å½•</span>
                </div>
            </div>
        </div>
        
        <!-- è®¾ç½®æŒ‰é’® -->
        <button id="settingsBtn">âš™ï¸</button>
        
        <!-- ç•ªèŒ„é’Ÿä¸»é¡µ -->
        <div id="homePage">
            <h1>ç•ªèŒ„é’Ÿ++</h1>
            <input type="text" id="task" placeholder="ä½ æ­£åœ¨å­¦ä¹ ä»€ä¹ˆç¼–ç¨‹å†…å®¹ï¼Ÿ">
            <div id="timer">25:00</div>
            <div class="progress-indicator" id="progressIndicator">æ¨¡å¼A: å•ç•ªèŒ„é’Ÿ (1/1)</div>
            <div class="buttons">
                <button id="startPauseBtn">å¼€å§‹ä¸“æ³¨</button>
                <button id="resetBtn">é‡ç½®</button>
            </div>
            <div id="countDisplay">ä»Šæ—¥å·²å®Œæˆ: <span id="count">0</span> ä¸ªç•ªèŒ„é’Ÿ</div>
            <div class="shortcut-hint">å¿«æ·é”®: ç©ºæ ¼é”® - å¼€å§‹/æš‚åœ, Ré”® - é‡ç½®</div>

            <!-- å¤šæ¤ç‰©ç§æ¤ç³»ç»Ÿ -->
            <div class="plant-system">
                <h3>æˆ‘çš„æ¤ç‰©å›­</h3>
                
                <!-- æ¤ç‰©é€‰æ‹© -->
                <div class="plant-selector">
                    <label>é€‰æ‹©æ¤ç‰©:</label>
                    <select id="plantType">
                        <option value="tomato">ğŸ… ç•ªèŒ„ (25åˆ†é’Ÿ)</option>
                        <option value="carrot">ğŸ¥• èƒ¡èåœ (15åˆ†é’Ÿ)</option>
                        <option value="broccoli">ğŸ¥¦ è¥¿å…°èŠ± (20åˆ†é’Ÿ)</option>
                        <option value="eggplant">ğŸ† èŒ„å­ (30åˆ†é’Ÿ)</option>
                        <option value="corn">ğŸŒ½ ç‰ç±³ (35åˆ†é’Ÿ)</option>
                        <option value="watermelon">ğŸ‰ è¥¿ç“œ (45åˆ†é’Ÿ)</option>
                        <option value="strawberry">ğŸ“ è‰è“ (10åˆ†é’Ÿ)</option>
                        <option value="pepper">ğŸ«‘ è¾£æ¤’ (18åˆ†é’Ÿ)</option>
                    </select>
                </div>

                <!-- æ¤ç‰©ä¿¡æ¯ -->
                <div class="plant-info">
                    <div class="plant-icon" id="currentPlantIcon">ğŸ…</div>
                    <div class="plant-details">
                        <div class="plant-name" id="currentPlantName">ç•ªèŒ„</div>
                        <div class="plant-time" id="currentPlantTime">æˆç†Ÿæ—¶é—´: 25åˆ†é’Ÿ</div>
                    </div>
                </div>

                <!-- æ¤ç‰©ç”Ÿé•¿å±•ç¤º - æ”¹ä¸ºä½¿ç”¨å›¾ç‰‡ -->
                <div class="plant-container">
                    <div class="soil"></div>
                    <div class="plant-stage" id="stage-seed">
                        <img src="images/plants/tomato-seed.png" alt="ç§å­é˜¶æ®µ">
                    </div>
                    <div class="plant-stage" id="stage-sprout">
                        <img src="images/plants/tomato-sprout.png" alt="å‘èŠ½é˜¶æ®µ">
                    </div>
                    <div class="plant-stage" id="stage-small">
                        <img src="images/plants/tomato-small.png" alt="å°è‹—é˜¶æ®µ">
                    </div>
                    <div class="plant-stage" id="stage-medium">
                        <img src="images/plants/tomato-medium.png" alt="ä¸­è‹—é˜¶æ®µ">
                    </div>
                    <div class="plant-stage" id="stage-mature">
                        <img src="images/plants/tomato-mature.png" alt="æˆç†Ÿé˜¶æ®µ">
                    </div>
                </div>

                <div class="growth-info">
                    <div>æˆé•¿è¿›åº¦: <span id="growth-percent">0</span>%</div>
                    <div class="growth-bar">
                        <div class="growth-progress" id="growth-progress" style="width: 0%"></div>
                    </div>
                    <div>å·²ç´¯ç§¯: <span id="growth-minutes">0</span> / <span id="total-minutes">25</span> åˆ†é’Ÿ</div>
                    <div class="harvest-stats" id="harvestStats"></div>
                </div>
                <button id="harvestBtn" class="new-plant-btn" style="display: none;">æ”¶è·æ¤ç‰©ï¼</button>
            </div>

            <!-- æ”¶è—æŸœ -->
            <div class="collection-section">
                <div class="collection-title">æˆ‘çš„æ¤ç‰©æ”¶è—æŸœ</div>
                <div class="collection-grid" id="collection-grid">
                    <!-- æ”¶è—çš„æ¤ç‰©ä¼šåŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
                </div>
            </div>
        </div>
        
        <!-- å†å²è®°å½•é¡µé¢ -->
        <div id="historyPage" class="history-section">
            <h2>å·²å®Œæˆç•ªèŒ„é’Ÿè®°å½•</h2>
            <div class="history-list" id="historyList">
                <!-- å†å²è®°å½•ä¼šåŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
                <div class="empty-history">æš‚æ— å†å²è®°å½•ï¼Œå®Œæˆç•ªèŒ„é’Ÿåå°†ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ</div>
            </div>
            <button class="clear-history" id="clearHistoryBtn">æ¸…ç©ºå†å²è®°å½•</button>
        </div>

        <!-- æ–°å¢è®¡åˆ’é¡µé¢ -->
        <div id="planPage" class="plan-section">
            <h2>å­¦ä¹ è®¡åˆ’</h2>
            <div class="plan-input">
                <input type="text" id="planInput" placeholder="æ·»åŠ æ–°çš„å­¦ä¹ è®¡åˆ’...">
                <button id="addPlanBtn">æ·»åŠ </button>
            </div>
            <div class="plan-list" id="planList">
                <!-- è®¡åˆ’é¡¹ä¼šåŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
                <div class="empty-plan">æš‚æ— è®¡åˆ’ï¼Œæ·»åŠ æ‚¨çš„å­¦ä¹ è®¡åˆ’</div>
            </div>
        </div>
    </div>

    <!-- è®¾ç½®é¢æ¿ -->
    <div class="settings-panel" id="settingsPanel">
        <h3>æ—¶é—´è®¾ç½®</h3>
        
        <div class="mode-selector">
            <div class="mode-tabs">
                <div class="mode-tab active" data-mode="A">æ¨¡å¼A: å•ç•ªèŒ„é’Ÿ</div>
                <div class="mode-tab" data-mode="B">æ¨¡å¼B: å¾ªç¯å¤šç•ªèŒ„é’Ÿ</div>
                <div class="mode-tab" data-mode="C">æ¨¡å¼C: è‡ªå®šä¹‰ç•ªèŒ„é’Ÿ</div>
            </div>
            
            <!-- æ¨¡å¼A: å•ç•ªèŒ„é’Ÿ -->
            <div class="mode-content active" id="modeA">
                <div class="setting-group">
                    <label for="modeA_duration">ç•ªèŒ„é’Ÿæ—¶é•¿ (åˆ†é’Ÿ)</label>
                    <input type="number" id="modeA_duration" class="setting-input" min="1" max="120" value="25">
                    <div class="setting-hint">è®¾ç½®å•ä¸ªç•ªèŒ„é’Ÿçš„å·¥ä½œæ—¶é•¿</div>
                </div>
            </div>
            
            <!-- æ¨¡å¼B: å¾ªç¯å¤šç•ªèŒ„é’Ÿ -->
            <div class="mode-content" id="modeB">
                <div class="setting-group">
                    <label for="modeB_duration">ç•ªèŒ„é’Ÿæ—¶é•¿ (åˆ†é’Ÿ)</label>
                    <input type="number" id="modeB_duration" class="setting-input" min="1" max="120" value="25">
                </div>
                <div class="setting-group">
                    <label for="modeB_count">ç•ªèŒ„é’Ÿä¸ªæ•°</label>
                    <input type="number" id="modeB_count" class="setting-input" min="1" max="20" value="4">
                </div>
                <div class="setting-group">
                    <label for="modeB_break">ä¼‘æ¯æ—¶é—´ (åˆ†é’Ÿ)</label>
                    <input type="number" id="modeB_break" class="setting-input" min="1" max="30" value="5">
                    <div class="setting-hint">æ¯ä¸ªç•ªèŒ„é’Ÿä¹‹é—´çš„ä¼‘æ¯æ—¶é—´</div>
                </div>
            </div>
            
            <!-- æ¨¡å¼C: è‡ªå®šä¹‰ç•ªèŒ„é’Ÿ -->
            <div class="mode-content" id="modeC">
                <div class="setting-group">
                    <label for="modeC_count">ç•ªèŒ„é’Ÿä¸ªæ•°</label>
                    <input type="number" id="modeC_count" class="setting-input" min="1" max="10" value="3">
                </div>
                <div class="setting-group">
                    <label for="modeC_durations">ç•ªèŒ„é’Ÿæ—¶é•¿ (åˆ†é’Ÿ)</label>
                    <input type="text" id="modeC_durations" class="setting-input" value="25,30,20">
                    <div class="setting-hint">è¾“å…¥æ¯ä¸ªç•ªèŒ„é’Ÿçš„æ—¶é•¿ï¼Œç”¨é€—å·åˆ†éš”ï¼Œä¾‹å¦‚: 25,30,20</div>
                </div>
                <div class="setting-group">
                    <label for="modeC_breaks">ä¼‘æ¯æ—¶é—´ (åˆ†é’Ÿ)</label>
                    <input type="text" id="modeC_breaks" class="setting-input" value="5,10">
                    <div class="setting-hint">è¾“å…¥æ¯ä¸ªä¼‘æ¯æ—¶é•¿ï¼Œç”¨é€—å·åˆ†éš”ï¼Œä¾‹å¦‚: 5,10 (ä¸ªæ•°æ¯”ç•ªèŒ„é’Ÿå°‘1)</div>
                </div>
            </div>
        </div>
        
        <div class="setting-buttons">
            <button id="cancelSettings">å–æ¶ˆ</button>
            <button id="saveSettings">ä¿å­˜</button>
        </div>
    </div>

    <!-- é®ç½©å±‚ -->
    <div class="overlay" id="overlay"></div>

    <!-- é€šçŸ¥ -->
    <div class="notification" id="notification"></div>

    <!-- æ‰˜ç›˜é€šçŸ¥ -->
    <div class="tray-notification" id="trayNotification">
        åº”ç”¨å·²æœ€å°åŒ–åˆ°ç³»ç»Ÿæ‰˜ç›˜
    </div>

    <!-- éŸ³æ•ˆ -->
    <audio id="workEndSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3" type="audio/mpeg">
    </audio>
    <audio id="breakEndSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-positive-notification-951.mp3" type="audio/mpeg">
    </audio>

    <script>
        // æ¤ç‰©æ•°æ®å®šä¹‰ - æ›´æ–°ä¸ºåŒ…å«å›¾ç‰‡è·¯å¾„
        const plants = {
            tomato: {
                name: "ç•ªèŒ„",
                icon: "ğŸ…",
                growthTime: 25,
                color: "#e74c3c",
                fruitColor: "#e74c3c",
                stages: [0, 5, 10, 15, 25],
                images: {
                    seed: "images/plants/tomato-seed.png",
                    sprout: "images/plants/tomato-sprout.png",
                    small: "images/plants/tomato-small.png",
                    medium: "images/plants/tomato-medium.png",
                    mature: "images/plants/tomato-mature.png"
                }
            },
            carrot: {
                name: "èƒ¡èåœ",
                icon: "ğŸ¥•",
                growthTime: 15,
                color: "#e67e22",
                fruitColor: "#e67e22", 
                stages: [0, 3, 6, 9, 15],
                images: {
                    seed: "images/plants/carrot-seed.png",
                    sprout: "images/plants/carrot-sprout.png",
                    small: "images/plants/carrot-small.png",
                    medium: "images/plants/carrot-medium.png",
                    mature: "images/plants/carrot-mature.png"
                }
            },
            broccoli: {
                name: "è¥¿å…°èŠ±",
                icon: "ğŸ¥¦",
                growthTime: 20,
                color: "#27ae60",
                fruitColor: "#27ae60",
                stages: [0, 4, 8, 12, 20],
                images: {
                    seed: "images/plants/broccoli-seed.png",
                    sprout: "images/plants/broccoli-sprout.png",
                    small: "images/plants/broccoli-small.png",
                    medium: "images/plants/broccoli-medium.png",
                    mature: "images/plants/broccoli-mature.png"
                }
            },
            eggplant: {
                name: "èŒ„å­",
                icon: "ğŸ†",
                growthTime: 30,
                color: "#8e44ad",
                fruitColor: "#8e44ad",
                stages: [0, 6, 12, 18, 30],
                images: {
                    seed: "images/plants/eggplant-seed.png",
                    sprout: "images/plants/eggplant-sprout.png",
                    small: "images/plants/eggplant-small.png",
                    medium: "images/plants/eggplant-medium.png",
                    mature: "images/plants/eggplant-mature.png"
                }
            },
            corn: {
                name: "ç‰ç±³",
                icon: "ğŸŒ½",
                growthTime: 35,
                color: "#f1c40f",
                fruitColor: "#f1c40f",
                stages: [0, 7, 14, 21, 35],
                images: {
                    seed: "images/plants/corn-seed.png",
                    sprout: "images/plants/corn-sprout.png",
                    small: "images/plants/corn-small.png",
                    medium: "images/plants/corn-medium.png",
                    mature: "images/plants/corn-mature.png"
                }
            },
            watermelon: {
                name: "è¥¿ç“œ",
                icon: "ğŸ‰",
                growthTime: 45,
                color: "#2ecc71",
                fruitColor: "#2ecc71",
                stages: [0, 9, 18, 27, 45],
                images: {
                    seed: "images/plants/watermelon-seed.png",
                    sprout: "images/plants/watermelon-sprout.png",
                    small: "images/plants/watermelon-small.png",
                    medium: "images/plants/watermelon-medium.png",
                    mature: "images/plants/watermelon-mature.png"
                }
            },
            strawberry: {
                name: "è‰è“",
                icon: "ğŸ“",
                growthTime: 10,
                color: "#e74c3c",
                fruitColor: "#e74c3c",
                stages: [0, 2, 4, 6, 10],
                images: {
                    seed: "images/plants/strawberry-seed.png",
                    sprout: "images/plants/strawberry-sprout.png",
                    small: "images/plants/strawberry-small.png",
                    medium: "images/plants/strawberry-medium.png",
                    mature: "images/plants/strawberry-mature.png"
                }
            },
            pepper: {
                name: "è¾£æ¤’",
                icon: "ğŸ«‘",
                growthTime: 18,
                color: "#e74c3c",
                fruitColor: "#e74c3c",
                stages: [0, 3.6, 7.2, 10.8, 18],
                images: {
                    seed: "images/plants/pepper-seed.png",
                    sprout: "images/plants/pepper-sprout.png",
                    small: "images/plants/pepper-small.png",
                    medium: "images/plants/pepper-medium.png",
                    mature: "images/plants/pepper-mature.png"
                }
            }
        };

        // ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡æ¥ç®¡ç†æ‰€æœ‰çŠ¶æ€ï¼Œé¿å…å…¨å±€å˜é‡æ±¡æŸ“
        const tomatoTimer = {
            // è®¡æ—¶å™¨çŠ¶æ€
            currentTime: 25 * 60,
            timerId: null,
            isRunning: false,
            isWorkSession: true,
            count: 0,
            lastPlantPercent: 0,
            
            // å¤šæ¤ç‰©ç³»ç»ŸçŠ¶æ€ - ä¿®æ”¹ï¼šæ¯ä¸ªæ¤ç‰©æœ‰ç‹¬ç«‹çš„æˆé•¿è¿›åº¦
            currentPlant: 'tomato',
            plantGrowths: {}, // æ”¹ä¸ºå¯¹è±¡ï¼Œå­˜å‚¨æ¯ä¸ªæ¤ç‰©çš„æˆé•¿å€¼
            collection: [], // æ”¶è—æŸœä¸­çš„æ¤ç‰©
            
            // å†å²è®°å½•
            history: [],
            
            // è®¡åˆ’åŠŸèƒ½
            plans: [],
            
            // æ¨¡å¼è®¾ç½®
            currentMode: 'A',
            modeSettings: {
                A: { duration: 25 },
                B: { duration: 25, count: 4, break: 5 },
                C: { count: 3, durations: [25, 30, 20], breaks: [5, 10] }
            },
            
            // å½“å‰è¿›åº¦
            currentSession: 0, // å½“å‰ç•ªèŒ„é’Ÿåºå·
            currentBreak: 0,   // å½“å‰ä¼‘æ¯åºå·
            
            // æ–°å¢å±æ€§ï¼šè®°å½•å½“å‰ç•ªèŒ„é’Ÿå·²è¿›è¡Œçš„æ—¶é—´ï¼ˆç§’ï¼‰
            currentSessionElapsed: 0,
            
            // DOM å…ƒç´ å¼•ç”¨
            elements: {},
            
            // åˆå§‹åŒ–æ–¹æ³•
            init() {
                // è·å–DOMå…ƒç´ å¼•ç”¨
                this.elements = {
                    timerDisplay: document.getElementById('timer'),
                    startPauseBtn: document.getElementById('startPauseBtn'),
                    resetBtn: document.getElementById('resetBtn'),
                    countDisplay: document.getElementById('count'),
                    taskInput: document.getElementById('task'),
                    progressIndicator: document.getElementById('progressIndicator'),
                    workEndSound: document.getElementById('workEndSound'),
                    breakEndSound: document.getElementById('breakEndSound'),
                    // æ¤ç‰©ç³»ç»Ÿå…ƒç´ 
                    plantType: document.getElementById('plantType'),
                    currentPlantIcon: document.getElementById('currentPlantIcon'),
                    currentPlantName: document.getElementById('currentPlantName'),
                    currentPlantTime: document.getElementById('currentPlantTime'),
                    growthPercent: document.getElementById('growth-percent'),
                    growthProgress: document.getElementById('growth-progress'),
                    growthMinutes: document.getElementById('growth-minutes'),
                    totalMinutes: document.getElementById('total-minutes'),
                    harvestBtn: document.getElementById('harvestBtn'),
                    collectionGrid: document.getElementById('collection-grid'),
                    notification: document.getElementById('notification'),
                    trayNotification: document.getElementById('trayNotification'),
                    harvestStats: document.getElementById('harvestStats'),
                    // é¡µé¢åˆ‡æ¢å…ƒç´ 
                    homePage: document.getElementById('homePage'),
                    historyPage: document.getElementById('historyPage'),
                    homeBtn: document.getElementById('homeBtn'),
                    historyBtn: document.getElementById('historyBtn'),
                    historyList: document.getElementById('historyList'),
                    clearHistoryBtn: document.getElementById('clearHistoryBtn'),
                    // è®¾ç½®é¢æ¿å…ƒç´ 
                    settingsBtn: document.getElementById('settingsBtn'),
                    settingsPanel: document.getElementById('settingsPanel'),
                    overlay: document.getElementById('overlay'),
                    saveSettingsBtn: document.getElementById('saveSettings'),
                    cancelSettingsBtn: document.getElementById('cancelSettings'),
                    // æ¨¡å¼è®¾ç½®å…ƒç´ 
                    modeTabs: document.querySelectorAll('.mode-tab'),
                    modeContents: document.querySelectorAll('.mode-content'),
                    modeA_duration: document.getElementById('modeA_duration'),
                    modeB_duration: document.getElementById('modeB_duration'),
                    modeB_count: document.getElementById('modeB_count'),
                    modeB_break: document.getElementById('modeB_break'),
                    modeC_count: document.getElementById('modeC_count'),
                    modeC_durations: document.getElementById('modeC_durations'),
                    modeC_breaks: document.getElementById('modeC_breaks'),
                    // æ–°æ·»åŠ çš„å…ƒç´ 
                    menuToggleBtn: document.getElementById('menuToggleBtn'),
                    dropdownMenu: document.getElementById('dropdownMenu'),
                    planPage: document.getElementById('planPage'),
                    planInput: document.getElementById('planInput'),
                    addPlanBtn: document.getElementById('addPlanBtn'),
                    planList: document.getElementById('planList')
                };
                
                // åˆ›å»ºçŠ¶æ€æ˜¾ç¤ºå…ƒç´ 
                this.elements.statusDisplay = document.createElement('div');
                this.elements.statusDisplay.className = 'status';
                document.querySelector('.container').appendChild(this.elements.statusDisplay);
                
                // åŠ è½½ä¿å­˜çš„æ•°æ®
                this.loadFromStorage();
                
                // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
                this.bindEvents();
                this.bindNewEvents();
                
                // åˆå§‹åŒ–æ˜¾ç¤º
                this.updateStatus();
                this.updateDisplay();
                this.updateCountDisplay();
                this.updatePlantDisplay();
                this.renderCollection();
                this.renderHistory();
                this.updateProgressIndicator();
                
                // åŠ è½½è®¡åˆ’æ•°æ®
                this.loadPlans();
                
                // åˆå§‹åŒ–æ¤ç‰©è¿›åº¦è·Ÿè¸ª
                const plant = plants[this.currentPlant];
                const currentGrowth = this.getCurrentPlantGrowth();
                const currentPercent = Math.min(100, (currentGrowth / plant.growthTime) * 100);
                this.lastPlantPercent = currentPercent;
                
                // é€šçŸ¥ç”¨æˆ·åº”ç”¨å·²å¯åŠ¨
                this.showNotification('ç•ªèŒ„é’Ÿåº”ç”¨å·²å¯åŠ¨');
            },
            
            // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
            bindEvents() {
                // ä¸ºæ‰€æœ‰å…ƒç´ æ·»åŠ å®‰å…¨æ£€æŸ¥
                if (this.elements.startPauseBtn) {
                    this.elements.startPauseBtn.addEventListener('click', () => this.toggleTimer());
                }
                
                if (this.elements.resetBtn) {
                    this.elements.resetBtn.addEventListener('click', () => this.resetTimer());
                }
                
                if (this.elements.taskInput) {
                    this.elements.taskInput.addEventListener('input', () => this.saveToStorage());
                }
                
                if (this.elements.harvestBtn) {
                    this.elements.harvestBtn.addEventListener('click', () => this.harvestPlant());
                }
                
                if (this.elements.plantType) {
                    this.elements.plantType.addEventListener('change', () => this.changePlant());
                }
                
                if (this.elements.homeBtn) {
                    this.elements.homeBtn.addEventListener('click', () => this.showPage('home'));
                }
                
                if (this.elements.historyBtn) {
                    this.elements.historyBtn.addEventListener('click', () => this.showPage('history'));
                }
                
                if (this.elements.clearHistoryBtn) {
                    this.elements.clearHistoryBtn.addEventListener('click', () => this.clearHistory());
                }
                
                if (this.elements.settingsBtn) {
                    this.elements.settingsBtn.addEventListener('click', () => this.openSettings());
                }
                
                if (this.elements.saveSettingsBtn) {
                    this.elements.saveSettingsBtn.addEventListener('click', () => this.saveSettings());
                }
                
                if (this.elements.cancelSettingsBtn) {
                    this.elements.cancelSettingsBtn.addEventListener('click', () => this.closeSettings());
                }
                
                if (this.elements.overlay) {
                    this.elements.overlay.addEventListener('click', () => this.closeSettings());
                }
                
                // æ¨¡å¼åˆ‡æ¢äº‹ä»¶
                if (this.elements.modeTabs) {
                    this.elements.modeTabs.forEach(tab => {
                        tab.addEventListener('click', () => {
                            const mode = tab.getAttribute('data-mode');
                            this.switchModeTab(mode);
                        });
                    });
                }
                
                // é”®ç›˜å¿«æ·é”®
                document.addEventListener('keydown', (e) => {
                    if (e.code === 'Space') {
                        e.preventDefault();
                        this.toggleTimer();
                    } else if (e.code === 'KeyR') {
                        this.resetTimer();
                    } else if (e.code === 'Escape') {
                        this.closeSettings();
                    }
                });
            },

            // ç»‘å®šæ–°çš„äº‹ä»¶ç›‘å¬å™¨
            bindNewEvents() {
                // 1. ç»‘å®šèœå•åˆ‡æ¢æŒ‰é’®
                if (this.elements.menuToggleBtn) {
                    this.elements.menuToggleBtn.addEventListener('click', (e) => {
                        // è½»å¾®å»¶è¿Ÿæœ‰åŠ©äºé¿å…ä¸æ–‡æ¡£ç‚¹å‡»äº‹ä»¶çš„å†²çª
                        setTimeout(() => {
                            this.toggleDropdownMenu();
                        }, 10);
                    });
                }

                // 2. ç»‘å®šä¸‹æ‹‰èœå•é¡¹
                const menuItems = this.elements.dropdownMenu.querySelectorAll('.menu-item');
                menuItems.forEach(item => {
                    item.addEventListener('click', () => {
                        const page = item.getAttribute('data-page');
                        this.showPage(page);
                        this.closeDropdownMenu();
                    });
                });

                // 3. ç‚¹å‡»é¡µé¢å…¶ä»–åŒºåŸŸå…³é—­ä¸‹æ‹‰èœå•
                document.addEventListener('click', () => {
                    this.closeDropdownMenu();
                });

                // 4. é˜»æ­¢ä¸‹æ‹‰èœå•å†…éƒ¨çš„ç‚¹å‡»äº‹ä»¶å†’æ³¡åˆ°documentï¼ˆé¿å…ç«‹å³è§¦å‘ä¸Šè¿°çš„å…³é—­äº‹ä»¶ï¼‰
                if (this.elements.dropdownMenu) {
                    this.elements.dropdownMenu.addEventListener('click', (e) => {
                        e.stopPropagation(); // è¿™æ˜¯å¿…è¦çš„
                    });
                }

                // 5. ç»‘å®šè®¡åˆ’åŠŸèƒ½çš„æŒ‰é’®å’Œè¾“å…¥æ¡†
                if (this.elements.addPlanBtn) {
                    this.elements.addPlanBtn.addEventListener('click', () => this.addPlan());
                }
                if (this.elements.planInput) {
                    this.elements.planInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            this.addPlan();
                        }
                    });
                }
            },
            
            // åˆ‡æ¢ä¸‹æ‹‰èœå•æ˜¾ç¤º/éšè—
            toggleDropdownMenu() {
                if (this.elements.dropdownMenu.classList.contains('show')) {
                    this.closeDropdownMenu();
                } else {
                    this.openDropdownMenu();
                }
            },

            // æ‰“å¼€ä¸‹æ‹‰èœå•
            openDropdownMenu() {
                this.elements.dropdownMenu.classList.add('show');
            },

            // å…³é—­ä¸‹æ‹‰èœå•
            closeDropdownMenu() {
                this.elements.dropdownMenu.classList.remove('show');
            },
            
            // åˆ‡æ¢æ¨¡å¼æ ‡ç­¾
            switchModeTab(mode) {
                // æ›´æ–°æ ‡ç­¾
                this.elements.modeTabs.forEach(tab => {
                    if (tab.getAttribute('data-mode') === mode) {
                        tab.classList.add('active');
                    } else {
                        tab.classList.remove('active');
                    }
                });
                
                // æ›´æ–°å†…å®¹
                this.elements.modeContents.forEach(content => {
                    if (content.id === `mode${mode}`) {
                        content.classList.add('active');
                    } else {
                        content.classList.remove('active');
                    }
                });
            },
            
            // ä»localStorageåŠ è½½æ•°æ®
            loadFromStorage() {
                const savedCount = localStorage.getItem('tomatoCount');
                const savedTask = localStorage.getItem('currentTask');
                const savedMode = localStorage.getItem('currentMode');
                const savedModeSettings = localStorage.getItem('modeSettings');
                
                // æ¤ç‰©ç³»ç»Ÿæ•°æ®
                const savedPlant = localStorage.getItem('currentPlant');
                const savedPlantGrowths = localStorage.getItem('plantGrowths'); // æ”¹ä¸ºplantGrowths
                const savedCollection = localStorage.getItem('plantCollection');
                
                // å†å²è®°å½•æ•°æ®
                const savedHistory = localStorage.getItem('tomatoHistory');
                
                if (savedCount) {
                    this.count = parseInt(savedCount);
                }
                
                if (savedTask) {
                    this.elements.taskInput.value = savedTask;
                }
                
                if (savedMode) {
                    this.currentMode = savedMode;
                    this.switchModeTab(this.currentMode);
                }
                
                if (savedModeSettings) {
                    this.modeSettings = JSON.parse(savedModeSettings);
                    
                    // æ›´æ–°è®¾ç½®é¢æ¿çš„å€¼
                    this.elements.modeA_duration.value = this.modeSettings.A.duration;
                    this.elements.modeB_duration.value = this.modeSettings.B.duration;
                    this.elements.modeB_count.value = this.modeSettings.B.count;
                    this.elements.modeB_break.value = this.modeSettings.B.break;
                    this.elements.modeC_count.value = this.modeSettings.C.count;
                    this.elements.modeC_durations.value = this.modeSettings.C.durations.join(',');
                    this.elements.modeC_breaks.value = this.modeSettings.C.breaks.join(',');
                }
                
                // åŠ è½½æ¤ç‰©æ•°æ®
                if (savedPlant) {
                    this.currentPlant = savedPlant;
                    this.elements.plantType.value = this.currentPlant;
                }
                
                // åŠ è½½æ¤ç‰©æˆé•¿å€¼å¯¹è±¡
                if (savedPlantGrowths) {
                    this.plantGrowths = JSON.parse(savedPlantGrowths);
                } else {
                    // å¦‚æœæ²¡æœ‰ä¿å­˜çš„æ•°æ®ï¼Œåˆå§‹åŒ–æ‰€æœ‰æ¤ç‰©çš„æˆé•¿å€¼ä¸º0
                    Object.keys(plants).forEach(plantType => {
                        this.plantGrowths[plantType] = 0;
                    });
                }
                
                if (savedCollection) {
                    this.collection = JSON.parse(savedCollection);
                }
                
                // åŠ è½½å†å²è®°å½•
                if (savedHistory) {
                    this.history = JSON.parse(savedHistory);
                }
                
                // è®¾ç½®å½“å‰æ—¶é—´
                this.resetTimer();
            },
            
            // ä¿å­˜æ•°æ®åˆ°localStorage
            saveToStorage() {
                localStorage.setItem('tomatoCount', this.count.toString());
                localStorage.setItem('currentTask', this.elements.taskInput.value);
                localStorage.setItem('currentMode', this.currentMode);
                localStorage.setItem('modeSettings', JSON.stringify(this.modeSettings));
                
                // ä¿å­˜æ¤ç‰©ç³»ç»Ÿæ•°æ®
                localStorage.setItem('currentPlant', this.currentPlant);
                localStorage.setItem('plantGrowths', JSON.stringify(this.plantGrowths)); // æ”¹ä¸ºplantGrowths
                localStorage.setItem('plantCollection', JSON.stringify(this.collection));
                
                // ä¿å­˜å†å²è®°å½•
                localStorage.setItem('tomatoHistory', JSON.stringify(this.history));
            },

            // åŠ è½½è®¡åˆ’æ•°æ®
            loadPlans() {
                const savedPlans = localStorage.getItem('tomatoPlans');
                if (savedPlans) {
                    this.plans = JSON.parse(savedPlans);
                    this.renderPlans();
                }
            },

            // ä¿å­˜è®¡åˆ’æ•°æ®
            savePlans() {
                localStorage.setItem('tomatoPlans', JSON.stringify(this.plans));
            },
            
            // è·å–å½“å‰æ¤ç‰©çš„æˆé•¿å€¼
            getCurrentPlantGrowth() {
                if (!this.plantGrowths[this.currentPlant]) {
                    this.plantGrowths[this.currentPlant] = 0;
                }
                return this.plantGrowths[this.currentPlant];
            },
            
            // è®¾ç½®å½“å‰æ¤ç‰©çš„æˆé•¿å€¼
            setCurrentPlantGrowth(value) {
                this.plantGrowths[this.currentPlant] = value;
            },
            
            // æ›´æ–°è®¡æ•°æ˜¾ç¤º
            updateCountDisplay() {
                this.elements.countDisplay.textContent = this.count;
            },
            
            // æ›´æ–°è¿›åº¦æŒ‡ç¤ºå™¨
            updateProgressIndicator() {
                let text = '';
                switch(this.currentMode) {
                    case 'A':
                        text = `æ¨¡å¼A: å•ç•ªèŒ„é’Ÿ (${this.isWorkSession ? 'å·¥ä½œä¸­' : 'å·²å®Œæˆ'})`;
                        break;
                    case 'B':
                        const totalSessions = this.modeSettings.B.count;
                        const current = this.isWorkSession ? this.currentSession : this.currentSession - 1;
                        text = `æ¨¡å¼B: å¾ªç¯å¤šç•ªèŒ„é’Ÿ (${current}/${totalSessions})`;
                        break;
                    case 'C':
                        const total = this.modeSettings.C.durations.length;
                        const currentC = this.isWorkSession ? this.currentSession : this.currentSession - 1;
                        text = `æ¨¡å¼C: è‡ªå®šä¹‰ç•ªèŒ„é’Ÿ (${currentC}/${total})`;
                        break;
                }
                this.elements.progressIndicator.textContent = text;
            },
            
            // æ›´æ–°çŠ¶æ€æ˜¾ç¤ºå’ŒèƒŒæ™¯
            updateStatus() {
                if (this.isWorkSession) {
                    document.body.className = 'working';
                    this.elements.statusDisplay.textContent = 'ä¸“æ³¨å·¥ä½œä¸­';
                    this.elements.statusDisplay.className = 'status work';
                } else {
                    document.body.className = 'breaking';
                    this.elements.statusDisplay.textContent = 'ä¼‘æ¯æ—¶é—´';
                    this.elements.statusDisplay.className = 'status break';
                }
                this.updateProgressIndicator();
            },
            
            // æ›´æ–°è®¡æ—¶å™¨æ˜¾ç¤º
            updateDisplay() {
                const minutes = Math.floor(this.currentTime / 60).toString().padStart(2, '0');
                const seconds = (this.currentTime % 60).toString().padStart(2, '0');
                this.elements.timerDisplay.textContent = `${minutes}:${seconds}`;
                
                // æ›´æ–°é¡µé¢æ ‡é¢˜
                const status = this.isWorkSession ? 'ä¸“æ³¨' : 'ä¼‘æ¯';
                document.title = `${minutes}:${seconds} - ${status} | ç•ªèŒ„é’Ÿ++`;
            },
            
            // æ˜¾ç¤ºé¡µé¢
            showPage(page) {
                // éšè—æ‰€æœ‰é¡µé¢
                this.elements.homePage.style.display = 'none';
                this.elements.historyPage.style.display = 'none';
                this.elements.planPage.style.display = 'none';
                
                // ç§»é™¤æ‰€æœ‰èœå•é¡¹çš„æ¿€æ´»çŠ¶æ€
                const menuItems = this.elements.dropdownMenu.querySelectorAll('.menu-item');
                menuItems.forEach(item => {
                    item.classList.remove('active');
                });
                
                // æ˜¾ç¤ºé€‰ä¸­çš„é¡µé¢å¹¶è®¾ç½®æ¿€æ´»çŠ¶æ€
                switch(page) {
                    case 'home':
                        this.elements.homePage.style.display = 'block';
                        document.querySelector('.menu-item[data-page="home"]').classList.add('active');
                        break;
                    case 'history':
                        this.elements.historyPage.style.display = 'block';
                        document.querySelector('.menu-item[data-page="history"]').classList.add('active');
                        break;
                    case 'plan':
                        this.elements.planPage.style.display = 'block';
                        document.querySelector('.menu-item[data-page="plan"]').classList.add('active');
                        break;
                }
                
                // æ›´æ–°åŸæœ‰çš„æŒ‰é’®çŠ¶æ€ï¼ˆè™½ç„¶éšè—äº†ï¼Œä½†ä¿æŒçŠ¶æ€åŒæ­¥ï¼‰
                this.elements.homeBtn.classList.toggle('active', page === 'home');
                this.elements.historyBtn.classList.toggle('active', page === 'history');
            },
            
            // åˆ‡æ¢æ¤ç‰© - ä¿®æ”¹ï¼šæ¯ä¸ªæ¤ç‰©æœ‰ç‹¬ç«‹çš„è¿›åº¦
            changePlant() {
                this.currentPlant = this.elements.plantType.value;
                this.updatePlantDisplay();
                this.updatePetStatus();
                this.saveToStorage();
                
                const plant = plants[this.currentPlant];
                this.showNotification(`å·²é€‰æ‹©ç§æ¤: ${plant.name} ${plant.icon}`);
            },
            
            // åˆ‡æ¢ä¼šè¯ï¼ˆå·¥ä½œ/ä¼‘æ¯ï¼‰
            switchSession() {
                if (this.isWorkSession) {
                    // å·¥ä½œç»“æŸï¼Œåˆ‡æ¢åˆ°ä¼‘æ¯
                    this.isWorkSession = false;
                    
                    // å¢åŠ æ¤ç‰©æˆé•¿å€¼ï¼ˆä¸“æ³¨æ—¶é—´ï¼‰- ä¿®æ”¹ï¼šä½¿ç”¨å½“å‰æ¤ç‰©çš„æˆé•¿å€¼
                    const workMinutes = this.getCurrentWorkTime() / 60;
                    this.addGrowth(workMinutes);
                    
                    // ä¿å­˜ç•ªèŒ„é’Ÿè®°å½•
                    if (this.elements.taskInput.value.trim()) {
                        this.addToHistory(this.elements.taskInput.value.trim());
                    }
                    
                    // æ’­æ”¾å·¥ä½œç»“æŸéŸ³æ•ˆ
                    this.elements.workEndSound.play();
                    
                    // æ ¹æ®æ¨¡å¼å†³å®šä¸‹ä¸€æ­¥
                    if (this.currentMode === 'A') {
                        // æ¨¡å¼A: å•ç•ªèŒ„é’Ÿï¼Œç»“æŸåé‡ç½®
                        this.showNotification('å·¥ä½œæ—¶é—´ç»“æŸï¼');
                        this.resetTimer();
                        return;
                    } else if (this.currentMode === 'B') {
                        // æ¨¡å¼B: å¾ªç¯å¤šç•ªèŒ„é’Ÿ
                        if (this.currentSession >= this.modeSettings.B.count) {
                            // æ‰€æœ‰ç•ªèŒ„é’Ÿå®Œæˆ
                            this.showNotification('æ­å–œï¼æ‰€æœ‰ç•ªèŒ„é’Ÿå·²å®Œæˆï¼');
                            this.resetTimer();
                            return;
                        } else {
                            // å¼€å§‹ä¼‘æ¯
                            this.currentTime = this.modeSettings.B.break * 60;
                            this.showNotification('å·¥ä½œæ—¶é—´ç»“æŸï¼å¼€å§‹ä¼‘æ¯ã€‚');
                        }
                    } else if (this.currentMode === 'C') {
                        // æ¨¡å¼C: è‡ªå®šä¹‰ç•ªèŒ„é’Ÿ
                        if (this.currentSession >= this.modeSettings.C.durations.length) {
                            // æ‰€æœ‰ç•ªèŒ„é’Ÿå®Œæˆ
                            this.showNotification('æ­å–œï¼æ‰€æœ‰ç•ªèŒ„é’Ÿå·²å®Œæˆï¼');
                            this.resetTimer();
                            return;
                        } else {
                            // å¼€å§‹ä¼‘æ¯
                            const breakIndex = this.currentSession - 1;
                            if (breakIndex < this.modeSettings.C.breaks.length) {
                                this.currentTime = this.modeSettings.C.breaks[breakIndex] * 60;
                                this.showNotification('å·¥ä½œæ—¶é—´ç»“æŸï¼å¼€å§‹ä¼‘æ¯ã€‚');
                            } else {
                                // æ²¡æœ‰æ›´å¤šä¼‘æ¯ï¼Œç›´æ¥å¼€å§‹ä¸‹ä¸€ä¸ªç•ªèŒ„é’Ÿ
                                this.isWorkSession = true;
                                this.currentSession++;
                                this.currentTime = this.modeSettings.C.durations[this.currentSession - 1] * 60;
                                this.showNotification('å·¥ä½œæ—¶é—´ç»“æŸï¼å¼€å§‹ä¸‹ä¸€ä¸ªç•ªèŒ„é’Ÿã€‚');
                            }
                        }
                    }
                } else {
                    // ä¼‘æ¯ç»“æŸï¼Œåˆ‡æ¢å›å·¥ä½œ
                    this.isWorkSession = true;
                    this.currentSession++;
                    
                    // æ’­æ”¾ä¼‘æ¯ç»“æŸéŸ³æ•ˆ
                    this.elements.breakEndSound.play();
                    
                    // æ ¹æ®æ¨¡å¼è®¾ç½®å·¥ä½œæ—¶é—´
                    if (this.currentMode === 'B') {
                        this.currentTime = this.modeSettings.B.duration * 60;
                        this.showNotification('ä¼‘æ¯æ—¶é—´ç»“æŸï¼å¼€å§‹ä¸‹ä¸€ä¸ªç•ªèŒ„é’Ÿã€‚');
                    } else if (this.currentMode === 'C') {
                        if (this.currentSession <= this.modeSettings.C.durations.length) {
                            this.currentTime = this.modeSettings.C.durations[this.currentSession - 1] * 60;
                            this.showNotification('ä¼‘æ¯æ—¶é—´ç»“æŸï¼å¼€å§‹ä¸‹ä¸€ä¸ªç•ªèŒ„é’Ÿã€‚');
                        }
                    }
                }
                
                // é‡ç½®å½“å‰ä¼šè¯å·²è¿›è¡Œæ—¶é—´
                this.currentSessionElapsed = 0;
                
                this.updateStatus();
                this.updateDisplay();
                this.updatePlantDisplay();
                this.updatePetStatus();
            },
            
            // è·å–å½“å‰å·¥ä½œæ—¶é—´
            getCurrentWorkTime() {
                switch(this.currentMode) {
                    case 'A':
                        return this.modeSettings.A.duration * 60;
                    case 'B':
                        return this.modeSettings.B.duration * 60;
                    case 'C':
                        if (this.currentSession > 0 && this.currentSession <= this.modeSettings.C.durations.length) {
                            return this.modeSettings.C.durations[this.currentSession - 1] * 60;
                        }
                        return 25 * 60; // é»˜è®¤å€¼
                    default:
                        return 25 * 60;
                }
            },
            
            // å¢åŠ æ¤ç‰©æˆé•¿å€¼ - ä¿®æ”¹ï¼šä½¿ç”¨å½“å‰æ¤ç‰©çš„æˆé•¿å€¼
            addGrowth(minutes) {
                const plant = plants[this.currentPlant];
                const growthTime = plant.growthTime;
                
                // è·å–å½“å‰æ¤ç‰©çš„æˆé•¿å€¼
                const currentGrowth = this.getCurrentPlantGrowth();
                
                // å¢åŠ æˆé•¿å€¼
                const newGrowth = currentGrowth + minutes;
                this.setCurrentPlantGrowth(newGrowth);
                
                // è®¡ç®—å¯ä»¥æ”¶è·çš„æ¤ç‰©æ•°é‡
                const harvestCount = Math.floor(newGrowth / growthTime);
                
                // å¦‚æœæœ‰å¯ä»¥æ”¶è·çš„æ¤ç‰©
                if (harvestCount > 0) {
                    // æ”¶è·æ¤ç‰©
                    for (let i = 0; i < harvestCount; i++) {
                        // éšæœºå†³å®šå“è´¨
                        const quality = this.getRandomQuality();
                        let displayName = plant.name;
                        
                        // æ ¹æ®å“è´¨è°ƒæ•´åç§°
                        if (quality === 'super') {
                            displayName = `è¶…çº§${plant.name}`;
                        } else if (quality === 'rare') {
                            displayName = `ç¨€æœ‰${plant.name}`;
                        }
                        
                        const newPlant = {
                            id: Date.now() + Math.random(),
                            type: this.currentPlant,
                            name: displayName,
                            originalName: plant.name,
                            icon: plant.icon,
                            color: plant.color,
                            date: new Date().toLocaleDateString(),
                            growth: growthTime,
                            quality: quality
                        };
                        this.collection.push(newPlant);
                        
                        // æ˜¾ç¤ºå“è´¨é€šçŸ¥
                        if (quality === 'super') {
                            this.showNotification(`ğŸ‰ æ­å–œï¼æ”¶è·äº†ä¸€ä¸ªè¶…çº§${plant.name}ï¼`);
                        } else if (quality === 'rare') {
                            this.showNotification(`âœ¨ å¤ªæ£’äº†ï¼æ”¶è·äº†ä¸€ä¸ªç¨€æœ‰${plant.name}ï¼`);
                        }
                    }
                    
                    // æ›´æ–°æˆé•¿å€¼ï¼ˆä¿ç•™ä½™æ•°ï¼‰
                    this.setCurrentPlantGrowth(newGrowth % growthTime);
                    
                    // æ›´æ–°æ˜¾ç¤º
                    this.renderCollection();
                    
                    // æ˜¾ç¤ºæ”¶è·é€šçŸ¥
                    this.showNotification(`æˆåŠŸæ”¶è·${harvestCount}ä¸ª${plant.name} ${plant.icon}ï¼å·²æ”¾å…¥æ”¶è—æŸœã€‚`);
                }
                
                // æ›´æ–°æ¤ç‰©æ˜¾ç¤º
                this.updatePlantDisplay();
                
                // ä¿å­˜æ•°æ®
                this.saveToStorage();
            },
            
            // éšæœºè·å–æ¤ç‰©å“è´¨
            getRandomQuality() {
                const random = Math.random();
                if (random < 0.1) { // 10% æ¦‚ç‡è¶…çº§å“è´¨
                    return 'super';
                } else if (random < 0.3) { // 20% æ¦‚ç‡ç¨€æœ‰å“è´¨
                    return 'rare';
                } else { // 70% æ¦‚ç‡æ™®é€šå“è´¨
                    return 'normal';
                }
            },
            
            // æ›´æ–°æ¤ç‰©æ˜¾ç¤º - ä¿®æ”¹ï¼šä½¿ç”¨ä¸´æ—¶æˆé•¿å€¼
            updatePlantDisplay() {
                const plant = plants[this.currentPlant];
                const growthTime = plant.growthTime;
                
                // è®¡ç®—ä¸´æ—¶æˆé•¿å€¼ï¼šæ°¸ä¹…æˆé•¿å€¼ + å½“å‰ç•ªèŒ„é’Ÿå·²è¿›è¡Œçš„æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰
                let tempGrowth = this.getCurrentPlantGrowth();
                if (this.isRunning && this.isWorkSession) {
                    // å½“å‰ç•ªèŒ„é’Ÿå·²è¿›è¡Œçš„æ—¶é—´ï¼ˆç§’ï¼‰è½¬æ¢ä¸ºåˆ†é’Ÿ
                    tempGrowth += this.currentSessionElapsed / 60;
                }
                
                const percent = Math.min(100, (tempGrowth / growthTime) * 100);
                
                // æ›´æ–°æ¤ç‰©ä¿¡æ¯
                this.elements.currentPlantIcon.textContent = plant.icon;
                this.elements.currentPlantName.textContent = plant.name;
                this.elements.currentPlantTime.textContent = `æˆç†Ÿæ—¶é—´: ${growthTime}åˆ†é’Ÿ`;
                this.elements.totalMinutes.textContent = growthTime;
                
                // æ›´æ–°è¿›åº¦æ˜¾ç¤º
                this.elements.growthPercent.textContent = Math.round(percent);
                this.elements.growthProgress.style.width = `${percent}%`;
                this.elements.growthProgress.style.background = `linear-gradient(90deg, ${plant.color}, ${plant.fruitColor})`;
                this.elements.growthMinutes.textContent = Math.round(tempGrowth);
                
                // æ›´æ–°æ”¶è·ç»Ÿè®¡
                const harvestCount = Math.floor(tempGrowth / growthTime);
                if (harvestCount > 0) {
                    this.elements.harvestStats.textContent = `å·²æ”¶è·: ${harvestCount}ä¸ª`;
                } else {
                    this.elements.harvestStats.textContent = '';
                }
                
                // æ›´æ–°æˆé•¿é˜¶æ®µ - ä½¿ç”¨å›¾ç‰‡
                const stages = ['seed', 'sprout', 'small', 'medium', 'mature'];
                stages.forEach(stage => {
                    const element = document.getElementById(`stage-${stage}`);
                    if (element) {
                        // æ›´æ–°å›¾ç‰‡æº
                        const img = element.querySelector('img');
                        if (img) {
                            img.src = plant.images[stage];
                            img.alt = `${plant.name} ${stage}é˜¶æ®µ`;
                        }
                        element.classList.remove('active');
                    }
                });
                
                // ç¡®å®šå½“å‰é˜¶æ®µ - åŸºäºä¸´æ—¶æˆé•¿å€¼
                let currentStageIndex = 0;
                for (let i = plant.stages.length - 1; i >= 0; i--) {
                    if (tempGrowth >= plant.stages[i]) {
                        currentStageIndex = i;
                        break;
                    }
                }
                
                // æ¿€æ´»å½“å‰é˜¶æ®µ
                const currentStageElement = document.getElementById(`stage-${stages[currentStageIndex]}`);
                if (currentStageElement) {
                    currentStageElement.classList.add('active');
                }
                
                // æ˜¾ç¤º/éšè—æ”¶è·æŒ‰é’®ï¼ˆåŸºäºä¸´æ—¶æˆé•¿å€¼ï¼‰
                if (tempGrowth >= growthTime) {
                    this.elements.harvestBtn.style.display = 'block';
                } else {
                    this.elements.harvestBtn.style.display = 'none';
                }
            },
            
            // æ”¶è·æ¤ç‰© - ä¿®æ”¹ï¼šä½¿ç”¨å½“å‰æ¤ç‰©çš„æˆé•¿å€¼
            harvestPlant() {
                const plant = plants[this.currentPlant];
                const growthTime = plant.growthTime;
                const currentGrowth = this.getCurrentPlantGrowth();
                
                // è®¡ç®—å¯ä»¥æ”¶è·çš„æ¤ç‰©æ•°é‡
                const harvestCount = Math.floor(currentGrowth / growthTime);
                
                if (harvestCount > 0) {
                    // æ”¶è·æ¤ç‰©
                    for (let i = 0; i < harvestCount; i++) {
                        // éšæœºå†³å®šå“è´¨
                        const quality = this.getRandomQuality();
                        let displayName = plant.name;
                        
                        // æ ¹æ®å“è´¨è°ƒæ•´åç§°
                        if (quality === 'super') {
                            displayName = `è¶…çº§${plant.name}`;
                        } else if (quality === 'rare') {
                            displayName = `ç¨€æœ‰${plant.name}`;
                        }
                        
                        const newPlant = {
                            id: Date.now() + Math.random(),
                            type: this.currentPlant,
                            name: displayName,
                            originalName: plant.name,
                            icon: plant.icon,
                            color: plant.color,
                            date: new Date().toLocaleDateString(),
                            growth: growthTime,
                            quality: quality
                        };
                        this.collection.push(newPlant);
                        
                        // æ˜¾ç¤ºå“è´¨é€šçŸ¥
                        if (quality === 'super') {
                            this.showNotification(`ğŸ‰ æ­å–œï¼æ”¶è·äº†ä¸€ä¸ªè¶…çº§${plant.name}ï¼`);
                        } else if (quality === 'rare') {
                            this.showNotification(`âœ¨ å¤ªæ£’äº†ï¼æ”¶è·äº†ä¸€ä¸ªç¨€æœ‰${plant.name}ï¼`);
                        }
                    }
                    
                    // æ›´æ–°æˆé•¿å€¼ï¼ˆä¿ç•™ä½™æ•°ï¼‰
                    this.setCurrentPlantGrowth(currentGrowth % growthTime);
                    
                    // æ›´æ–°æ˜¾ç¤º
                    this.updatePlantDisplay();
                    this.renderCollection();
                    
                    // ä¿å­˜æ•°æ®
                    this.saveToStorage();
                    
                    // æ˜¾ç¤ºé€šçŸ¥
                    this.showNotification(`æˆåŠŸæ”¶è·${harvestCount}ä¸ª${plant.name} ${plant.icon}ï¼å·²æ”¾å…¥æ”¶è—æŸœã€‚`);
                } else {
                    this.showNotification(`${plant.name}è¿˜æœªæˆç†Ÿï¼Œæ— æ³•æ”¶è·ï¼`);
                }
            },
            
            // æ¸²æŸ“æ”¶è—æŸœ
            renderCollection() {
                this.elements.collectionGrid.innerHTML = '';
                
                this.collection.forEach((plant, index) => {
                    const plantElement = document.createElement('div');
                    plantElement.className = 'collection-item';
                    plantElement.title = `${plant.name}\næ”¶è·äº: ${plant.date}`;
                    plantElement.style.background = plant.color;
                    
                    // æ ¹æ®å“è´¨è®¾ç½®æ–‡å­—æ ·å¼
                    const qualityClass = `quality-${plant.quality}`;
                    
                    plantElement.innerHTML = `
                        <div class="collection-icon">${plant.icon}</div>
                        <div class="${qualityClass}">${plant.name}</div>
                    `;
                    this.elements.collectionGrid.appendChild(plantElement);
                });
            },
            
            // æ˜¾ç¤ºé€šçŸ¥
            showNotification(message) {
                this.elements.notification.textContent = message;
                this.elements.notification.classList.add('show');
                
                setTimeout(() => {
                    this.elements.notification.classList.remove('show');
                }, 3000);
            },
            
            // æ˜¾ç¤ºæ‰˜ç›˜é€šçŸ¥
            showTrayNotification() {
                this.elements.trayNotification.classList.add('show');
                
                setTimeout(() => {
                    this.elements.trayNotification.classList.remove('show');
                }, 3000);
            },
            
            // æ·»åŠ å†å²è®°å½•
            addToHistory(taskName) {
                const now = new Date();
                const record = {
                    task: taskName,
                    date: now.toLocaleDateString(),
                    time: now.toLocaleTimeString(),
                    timestamp: now.getTime()
                };
                
                this.history.unshift(record);
                
                // é™åˆ¶å†å²è®°å½•æ•°é‡
                if (this.history.length > 50) {
                    this.history = this.history.slice(0, 50);
                }
                
                this.saveToStorage();
                this.renderHistory();
                
                // æ›´æ–°è®¡æ•°
                this.count++;
                this.updateCountDisplay();
                this.saveToStorage();
            },
            
            // æ¸²æŸ“å†å²è®°å½•
            renderHistory() {
                const historyList = this.elements.historyList;
                
                if (this.history.length === 0) {
                    historyList.innerHTML = '<div class="empty-history">æš‚æ— å†å²è®°å½•ï¼Œå®Œæˆç•ªèŒ„é’Ÿåå°†ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ</div>';
                    return;
                }
                
                historyList.innerHTML = '';
                
                this.history.forEach(record => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    historyItem.innerHTML = `
                        <div class="history-task">${record.task}</div>
                        <div>
                            <div class="history-time">${record.time}</div>
                            <div class="history-date">${record.date}</div>
                        </div>
                    `;
                    historyList.appendChild(historyItem);
                });
            },
            
            // æ¸…ç©ºå†å²è®°å½• - ä¿®æ”¹ï¼šåŒæ—¶æ¸…ç©ºä»Šæ—¥å®Œæˆç•ªèŒ„é’Ÿä¸ªæ•°
            clearHistory() {
                if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•å’Œä»Šæ—¥ç•ªèŒ„é’Ÿè®¡æ•°å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚')) {
                    this.history = [];
                    this.count = 0; // æ¸…ç©ºç•ªèŒ„é’Ÿè®¡æ•°
                    this.updateCountDisplay();
                    this.saveToStorage();
                    this.renderHistory();
                    this.showNotification('å†å²è®°å½•å’Œç•ªèŒ„é’Ÿè®¡æ•°å·²æ¸…ç©º');
                }
            },

            // æ·»åŠ è®¡åˆ’
            addPlan() {
                const planText = this.elements.planInput.value.trim();
                if (planText) {
                    const newPlan = {
                        id: Date.now() + Math.random(),
                        text: planText,
                        completed: false,
                        createdAt: new Date().toLocaleString()
                    };
                    
                    this.plans.unshift(newPlan);
                    this.elements.planInput.value = '';
                    this.renderPlans();
                    this.savePlans();
                    this.showNotification('è®¡åˆ’å·²æ·»åŠ ï¼');
                }
            },

            // æ¸²æŸ“è®¡åˆ’åˆ—è¡¨
            renderPlans() {
                const planList = this.elements.planList;
                
                if (this.plans.length === 0) {
                    planList.innerHTML = '<div class="empty-plan">æš‚æ— è®¡åˆ’ï¼Œæ·»åŠ æ‚¨çš„å­¦ä¹ è®¡åˆ’</div>';
                    return;
                }
                
                planList.innerHTML = '';
                
                this.plans.forEach(plan => {
                    const planItem = document.createElement('div');
                    planItem.className = 'plan-item';
                    planItem.innerHTML = `
                        <div class="plan-content">
                            <input type="checkbox" class="plan-checkbox" ${plan.completed ? 'checked' : ''} 
                                   data-id="${plan.id}">
                            <div class="plan-text ${plan.completed ? 'completed' : ''}">${plan.text}</div>
                        </div>
                        <div class="plan-actions">
                            <button class="plan-delete" data-id="${plan.id}">åˆ é™¤</button>
                        </div>
                    `;
                    planList.appendChild(planItem);
                });
                
                // ç»‘å®šè®¡åˆ’é¡¹äº‹ä»¶
                this.bindPlanEvents();
            },

            // ç»‘å®šè®¡åˆ’é¡¹äº‹ä»¶
            bindPlanEvents() {
                // å¤é€‰æ¡†äº‹ä»¶
                const checkboxes = this.elements.planList.querySelectorAll('.plan-checkbox');
                checkboxes.forEach(checkbox => {
                    checkbox.addEventListener('change', (e) => {
                        const planId = e.target.getAttribute('data-id');
                        this.togglePlanComplete(planId);
                    });
                });
                
                // åˆ é™¤æŒ‰é’®äº‹ä»¶
                const deleteButtons = this.elements.planList.querySelectorAll('.plan-delete');
                deleteButtons.forEach(button => {
                    button.addEventListener('click', (e) => {
                        const planId = e.target.getAttribute('data-id');
                        this.deletePlan(planId);
                    });
                });
            },

            // åˆ‡æ¢è®¡åˆ’å®ŒæˆçŠ¶æ€
            togglePlanComplete(planId) {
                const plan = this.plans.find(p => p.id == planId);
                if (plan) {
                    plan.completed = !plan.completed;
                    this.renderPlans();
                    this.savePlans();
                }
            },

            // åˆ é™¤è®¡åˆ’
            deletePlan(planId) {
                if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè®¡åˆ’å—ï¼Ÿ')) {
                    this.plans = this.plans.filter(p => p.id != planId);
                    this.renderPlans();
                    this.savePlans();
                    this.showNotification('è®¡åˆ’å·²åˆ é™¤');
                }
            },
            
            // æ‰“å¼€è®¾ç½®é¢æ¿
            openSettings() {
                // æš‚åœè®¡æ—¶å™¨
                if (this.isRunning) {
                    this.toggleTimer();
                }
                
                // æ˜¾ç¤ºè®¾ç½®é¢æ¿å’Œé®ç½©å±‚
                this.elements.settingsPanel.style.display = 'block';
                this.elements.overlay.style.display = 'block';
            },
            
            // å…³é—­è®¾ç½®é¢æ¿
            closeSettings() {
                // æ¢å¤åŸå§‹å€¼
                this.elements.modeA_duration.value = this.modeSettings.A.duration;
                this.elements.modeB_duration.value = this.modeSettings.B.duration;
                this.elements.modeB_count.value = this.modeSettings.B.count;
                this.elements.modeB_break.value = this.modeSettings.B.break;
                this.elements.modeC_count.value = this.modeSettings.C.count;
                this.elements.modeC_durations.value = this.modeSettings.C.durations.join(',');
                this.elements.modeC_breaks.value = this.modeSettings.C.breaks.join(',');
                
                // æ¢å¤æ¨¡å¼æ ‡ç­¾
                this.switchModeTab(this.currentMode);
                
                // éšè—è®¾ç½®é¢æ¿
                this.elements.settingsPanel.style.display = 'none';
                this.elements.overlay.style.display = 'none';
            },
            
            // ä¿å­˜è®¾ç½®
            saveSettings() {
                // è·å–å½“å‰æ¨¡å¼
                let activeMode = 'A';
                this.elements.modeTabs.forEach(tab => {
                    if (tab.classList.contains('active')) {
                        activeMode = tab.getAttribute('data-mode');
                    }
                });
                
                // éªŒè¯å¹¶ä¿å­˜è®¾ç½®
                try {
                    // æ¨¡å¼A
                    const modeA_duration = parseInt(this.elements.modeA_duration.value);
                    if (isNaN(modeA_duration) || modeA_duration <= 0) {
                        throw new Error('æ¨¡å¼A: è¯·è¾“å…¥æœ‰æ•ˆçš„ç•ªèŒ„é’Ÿæ—¶é•¿');
                    }
                    this.modeSettings.A.duration = modeA_duration;
                    
                    // æ¨¡å¼B
                    const modeB_duration = parseInt(this.elements.modeB_duration.value);
                    const modeB_count = parseInt(this.elements.modeB_count.value);
                    const modeB_break = parseInt(this.elements.modeB_break.value);
                    
                    if (isNaN(modeB_duration) || modeB_duration <= 0) {
                        throw new Error('æ¨¡å¼B: è¯·è¾“å…¥æœ‰æ•ˆçš„ç•ªèŒ„é’Ÿæ—¶é•¿');
                    }
                    if (isNaN(modeB_count) || modeB_count <= 0) {
                        throw new Error('æ¨¡å¼B: è¯·è¾“å…¥æœ‰æ•ˆçš„ç•ªèŒ„é’Ÿä¸ªæ•°');
                    }
                    if (isNaN(modeB_break) || modeB_break < 0) {
                        throw new Error('æ¨¡å¼B: è¯·è¾“å…¥æœ‰æ•ˆçš„ä¼‘æ¯æ—¶é—´');
                    }
                    
                    this.modeSettings.B.duration = modeB_duration;
                    this.modeSettings.B.count = modeB_count;
                    this.modeSettings.B.break = modeB_break;
                    
                    // æ¨¡å¼C
                    const modeC_count = parseInt(this.elements.modeC_count.value);
                    const modeC_durations = this.elements.modeC_durations.value.split(',').map(x => parseInt(x.trim()));
                    const modeC_breaks = this.elements.modeC_breaks.value.split(',').map(x => parseInt(x.trim()));
                    
                    if (isNaN(modeC_count) || modeC_count <= 0) {
                        throw new Error('æ¨¡å¼C: è¯·è¾“å…¥æœ‰æ•ˆçš„ç•ªèŒ„é’Ÿä¸ªæ•°');
                    }
                    if (modeC_durations.length !== modeC_count || modeC_durations.some(x => isNaN(x) || x <= 0)) {
                        throw new Error('æ¨¡å¼C: è¯·è¾“å…¥æœ‰æ•ˆçš„ç•ªèŒ„é’Ÿæ—¶é•¿');
                    }
                    if (modeC_breaks.length !== modeC_count - 1 || modeC_breaks.some(x => isNaN(x) || x < 0)) {
                        throw new Error('æ¨¡å¼C: è¯·è¾“å…¥æœ‰æ•ˆçš„ä¼‘æ¯æ—¶é—´');
                    }
                    
                    this.modeSettings.C.count = modeC_count;
                    this.modeSettings.C.durations = modeC_durations;
                    this.modeSettings.C.breaks = modeC_breaks;
                    
                    // æ›´æ–°å½“å‰æ¨¡å¼
                    this.currentMode = activeMode;
                    
                    // é‡ç½®è®¡æ—¶å™¨ä»¥åº”ç”¨æ–°è®¾ç½®
                    this.resetTimer();
                    
                    // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                    this.saveToStorage();
                    
                    // éšè—è®¾ç½®é¢æ¿
                    this.elements.settingsPanel.style.display = 'none';
                    this.elements.overlay.style.display = 'none';
                    
                    this.showNotification('è®¾ç½®å·²ä¿å­˜ï¼');
                } catch (error) {
                    alert(error.message);
                }
            },
            
            // å¼€å§‹/æš‚åœè®¡æ—¶å™¨
            toggleTimer() {
                if (!this.isRunning) {
                    // å¼€å§‹è®¡æ—¶
                    this.isRunning = true;
                    this.elements.startPauseBtn.textContent = 'æš‚åœ';
                    this.elements.startPauseBtn.style.background = 'linear-gradient(135deg, #f093fb, #f5576c)';
                    
                    this.timerId = setInterval(() => {
                        this.currentTime--;
                        this.currentSessionElapsed++;
                        
                        this.updateDisplay();
                        this.updatePetStatus(); // æ¯ç§’æ›´æ–°æ¡Œå® å€’è®¡æ—¶
                        
                        // è®¡ç®—å½“å‰æ¤ç‰©è¿›åº¦
                        const plant = plants[this.currentPlant];
                        const currentGrowth = this.getCurrentPlantGrowth();
                        let tempGrowth = currentGrowth;
                        if (this.isRunning && this.isWorkSession) {
                            tempGrowth += this.currentSessionElapsed / 60;
                        }
                        const currentPercent = Math.min(100, (tempGrowth / plant.growthTime) * 100);
                        
                        // åªæœ‰å½“æ¤ç‰©è¿›åº¦å˜åŒ–è¶…è¿‡1%æˆ–è€…æ¯10ç§’å¼ºåˆ¶æ›´æ–°æ—¶ï¼Œæ‰æ›´æ–°æ¤ç‰©å›¾ç‰‡
                        if (Math.abs(currentPercent - this.lastPlantPercent) >= 1 || this.currentSessionElapsed % 10 === 0) {
                            this.updatePlantDisplay();
                            this.lastPlantPercent = currentPercent;
                        }
                        
                        if (this.currentTime < 0) {
                            clearInterval(this.timerId);
                            this.isRunning = false;
                            this.switchSession();
                            
                            // è‡ªåŠ¨å¼€å§‹ä¸‹ä¸€ä¸ªä¼šè¯
                            if (this.currentMode !== 'A') {
                                setTimeout(() => {
                                    this.toggleTimer();
                                }, 1000);
                            }
                        }
                    }, 1000);
                } else {
                    // æš‚åœè®¡æ—¶
                    this.isRunning = false;
                    this.elements.startPauseBtn.textContent = 'ç»§ç»­';
                    this.elements.startPauseBtn.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
                    clearInterval(this.timerId);
                    
                    // æš‚åœæ—¶ä¹Ÿæ›´æ–°æ¤ç‰©æ˜¾ç¤ºå’Œæ¡Œå® çŠ¶æ€
                    this.updatePlantDisplay();
                    this.updatePetStatus();
                }
                this.saveToStorage();
            },
            
            // é‡ç½®è®¡æ—¶å™¨
            resetTimer() {
                this.isRunning = false;
                clearInterval(this.timerId);
                this.elements.startPauseBtn.textContent = 'å¼€å§‹ä¸“æ³¨';
                this.elements.startPauseBtn.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
                
                // é‡ç½®ä¼šè¯çŠ¶æ€å’Œç´¯è®¡æ—¶é—´ï¼ˆä¸ä¿å­˜åˆ°æ¤ç‰©æˆé•¿ï¼‰
                this.isWorkSession = true;
                this.currentSession = 1;
                this.currentBreak = 0;
                this.currentSessionElapsed = 0; // é‡ç½®ç´¯è®¡æ—¶é—´ï¼Œä¸ä¿å­˜åˆ°æ¤ç‰©æˆé•¿
                
                // æ ¹æ®å½“å‰æ¨¡å¼è®¾ç½®æ—¶é—´
                switch(this.currentMode) {
                    case 'A':
                        this.currentTime = this.modeSettings.A.duration * 60;
                        break;
                    case 'B':
                        this.currentTime = this.modeSettings.B.duration * 60;
                        break;
                    case 'C':
                        this.currentTime = this.modeSettings.C.durations[0] * 60;
                        break;
                    default:
                        this.currentTime = 25 * 60;
                }
                
                // æ›´æ–°æ¤ç‰©æ˜¾ç¤ºä¸ºæ°¸ä¹…æˆé•¿å€¼ï¼ˆä¸¢å¼ƒä¸´æ—¶è¿›åº¦ï¼‰
                this.updatePlantDisplay();
                
                this.updateStatus();
                this.updateDisplay();
                this.updateProgressIndicator();
                this.updatePetStatus();
                this.saveToStorage();
            },

            // æ›´æ–°æ¡Œå® çŠ¶æ€ - ä¿®å¤ç‰ˆæœ¬ï¼Œä½¿ç”¨ä¸´æ—¶è¿›åº¦
            updatePetStatus() {
                const plant = plants[this.currentPlant];
                const currentGrowth = this.getCurrentPlantGrowth();
                const growthTime = plant.growthTime;
                
                // è®¡ç®—ä¸´æ—¶æˆé•¿å€¼ï¼šæ°¸ä¹…æˆé•¿å€¼ + å½“å‰ç•ªèŒ„é’Ÿå·²è¿›è¡Œçš„æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰
                let tempGrowth = currentGrowth;
                if (this.isRunning && this.isWorkSession) {
                    // å½“å‰ç•ªèŒ„é’Ÿå·²è¿›è¡Œçš„æ—¶é—´ï¼ˆç§’ï¼‰è½¬æ¢ä¸ºåˆ†é’Ÿ
                    tempGrowth += this.currentSessionElapsed / 60;
                }
                
                const percent = Math.min(100, (tempGrowth / growthTime) * 100);
                
                const petData = {
                    timer: this.elements.timerDisplay.textContent, // è¿™ä¸ªä¼šæ¯ç§’æ›´æ–°
                    plantType: this.currentPlant,
                    plantName: plant.name,
                    growthPercent: percent,
                    isWorking: this.isWorkSession,
                    plantColor: plant.color,
                    fruitColor: plant.fruitColor
                };
                
                // å‘é€åˆ°ä¸»è¿›ç¨‹ï¼Œå†è½¬å‘åˆ°æ¡Œå® çª—å£
                if (window.require) {
                    try {
                        const { ipcRenderer } = window.require('electron');
                        ipcRenderer.send('update-pet-status', petData);
                    } catch (error) {
                        console.log('æ¡Œå® é€šä¿¡æš‚æ—¶ä¸å¯ç”¨');
                    }
                }
            }
        };

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            tomatoTimer.init();
        });
    </script>
</body>
</html>